local combat1 = createCombatObject()
setCombatParam(combat1, COMBAT_PARAM_EFFECT, 367)
setCombatParam(combat1, COMBAT_PARAM_TYPE, COMBAT_EARTHDAMAGE)
setCombatArea(combat1,createCombatArea({
{0, 1, 0},
{1, 2, 1},
{0, 1, 0}}))


local combat2 = createCombatObject()
setCombatParam(combat2, COMBAT_PARAM_EFFECT, 367)
setCombatParam(combat2, COMBAT_PARAM_TYPE, COMBAT_EARTHDAMAGE)
setCombatArea(combat2,createCombatArea({
{0, 0, 0, 1, 0, 0, 0},
{0, 0, 1, 0, 1, 0, 0},
{0, 1, 0, 0, 0, 1, 0},
{1, 0, 0, 2, 0, 0, 1},
{0, 1, 0, 0, 0, 1, 0},
{0, 0, 1, 0, 1, 0, 0},
{0, 0, 0, 1, 0, 0, 0}}))


local combat3 = createCombatObject()
setCombatParam(combat3, COMBAT_PARAM_EFFECT, 367)
setCombatParam(combat3, COMBAT_PARAM_TYPE, COMBAT_EARTHDAMAGE)
setCombatArea(combat3,createCombatArea({
{0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0},
{0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0},
{0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0},
{0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0},
{1, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1},
{0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0},
{0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0},
{0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0},
{0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0}}))


local combat4 = createCombatObject()
setCombatParam(combat4, COMBAT_PARAM_EFFECT, 367)
setCombatParam(combat4, COMBAT_PARAM_TYPE, COMBAT_EARTHDAMAGE)
setCombatArea(combat4,createCombatArea({
{0, 1, 0},
{1, 2, 1},
{0, 1, 0}}))


local combat5 = createCombatObject()
setCombatParam(combat5, COMBAT_PARAM_EFFECT, 367)
setCombatParam(combat5, COMBAT_PARAM_TYPE, COMBAT_EARTHDAMAGE)
setCombatArea(combat5,createCombatArea({
{0, 0, 1, 0, 0},
{0, 0, 0, 0, 0},
{1, 0, 2, 0, 1},
{0, 0, 0, 0, 0},
{0, 0, 1, 0, 0}}))


local combat6 = createCombatObject()
setCombatParam(combat6, COMBAT_PARAM_EFFECT, 367)
setCombatParam(combat6, COMBAT_PARAM_TYPE, COMBAT_EARTHDAMAGE)
setCombatArea(combat6,createCombatArea({
{0, 0, 0, 1, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0},
{1, 0, 0, 2, 0, 0, 1},
{0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 1, 0, 0, 0}}))


local combat7 = createCombatObject()
setCombatParam(combat7, COMBAT_PARAM_EFFECT, 367)
setCombatParam(combat7, COMBAT_PARAM_TYPE, COMBAT_EARTHDAMAGE)
setCombatArea(combat7,createCombatArea({
{0, 0, 0, 0, 1, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0, 0, 0},
{1, 0, 0, 0, 2, 0, 0, 0, 1},
{0, 0, 0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 1, 0, 0, 0, 0}}))


local combat8 = createCombatObject()
setCombatParam(combat8, COMBAT_PARAM_EFFECT, 367)
setCombatParam(combat8, COMBAT_PARAM_TYPE, COMBAT_EARTHDAMAGE)
setCombatArea(combat8,createCombatArea({
{0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{1, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1},
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0}}))


local function combatSpell(c,cid,var,dirList,dirEmitPos)
	if (isCreature(cid)) then
		doCombat(cid, c, var)
		if (dirList ~= nil and dirEmitPos ~= nil) then
			local i = 2;
			while (i < #dirList) do
				doSendDistanceShoot(dirEmitPos,{x=dirEmitPos.x-dirList[i],y=dirEmitPos.y-dirList[i+1],z=dirEmitPos.z},dirList[1])
				i = i + 2
			end		
		end
	end
end

function onCastSpell(creature, var)
	local cid = creature:getId()

	if isCreature(cid) then
		creature:say("Jade Energy!", TALKTYPE_MONSTER_SAY)
		creature:setNoMove(true)
	end
	addEvent(function()
	combatSpell(combat1,cid,var)
	addEvent(combatSpell,300,combat2,cid,var)
	addEvent(combatSpell,600,combat3,cid,var)
	addEvent(combatSpell,1000,combat4,cid,var)
	addEvent(combatSpell,1300,combat5,cid,var)
	addEvent(combatSpell,1600,combat6,cid,var)
	addEvent(combatSpell,1900,combat7,cid,var)
	addEvent(combatSpell,2100,combat8,cid,var)
	addEvent(function()
        if isCreature(cid) then
            creature:setNoMove(false)
        end
    end, 2600)
	end, 2000)
	return true
end